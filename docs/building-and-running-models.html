
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Building and running models &#8212; omdk 0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Module Documentation" href="modules.html" />
    <link rel="prev" title="Requirements" href="requirements.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="building-and-running-models">
<h1>Building and running models<a class="headerlink" href="#building-and-running-models" title="Permalink to this headline">¶</a></h1>
<p>The repository provides a Python toolkit for building, running and
testing Oasis models end-to-end, including performing individual steps
in this process. It includes:</p>
<ul class="simple">
<li>a Python class framework for working with Oasis models and model
resources as Python objects (the <code class="docutils literal"><span class="pre">models</span></code> subpackage)</li>
<li>a Python class framework for managing model exposures and resources,
and also for generating Oasis files from these (the <code class="docutils literal"><span class="pre">exposures</span></code>
subpackage)</li>
<li>a Python factory class for instantiating keys lookup services for
models, and generating and saving keys outputs from these lookup
services (the <code class="docutils literal"><span class="pre">keys</span></code> subpackage)</li>
<li>executable scripts, based on these class frameworks, for writing keys
outputs from model lookup services (<code class="docutils literal"><span class="pre">generate_keys.py</span></code>), generating
Oasis files from model source exposures and other resources
(<code class="docutils literal"><span class="pre">generate_oasis_files.py</span></code>), and generating losses for models
(<code class="docutils literal"><span class="pre">generate_losses.py</span></code>). This includes a “master” script that can
perform all these steps to run the model end-to-end
(<code class="docutils literal"><span class="pre">run_model.py</span></code>).</li>
</ul>
<div class="section" id="generating-keys">
<h2>Generating keys<a class="headerlink" href="#generating-keys" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">generate_keys.py</span></code> is an executable script which can generate and
write Oasis keys (area peril ID, vulnerability ID) for a model, given
the following arguments (in no particular order)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">generate_keys</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">k</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">keys</span><span class="o">/</span><span class="n">data</span>
                   <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">version</span><span class="o">/</span><span class="n">csv</span><span class="o">/</span><span class="n">file</span>
                   <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">lookup</span><span class="o">/</span><span class="n">service</span><span class="o">/</span><span class="n">package</span>
                   <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">exposures</span><span class="o">/</span><span class="n">csv</span><span class="o">/</span><span class="n">file</span>
                   <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">file</span>
                   <span class="p">[</span><span class="o">-</span><span class="n">f</span> <span class="o">&lt;</span><span class="n">output</span> <span class="nb">format</span> <span class="o">-</span> <span class="s1">&#39;oasis_keys&#39;</span> <span class="ow">or</span> <span class="s1">&#39;list_keys&#39;</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p>When calling the script this way paths can be given relative to the
script, in particular, file paths should include the filename and
extension. The paths to the keys data, lookup service package (Python
package containing the lookup source code), and model version file will
usually be located in the model keys server (Git) repository. If the
repository was created by or is managed by Oasis LMF then the lookup
service package will usually be contained in the <code class="docutils literal"><span class="pre">src/keys_server</span></code>
Python subpackage and can be given as the path to that subpackage (see
the OasisPiWind repository as a reference for how to structure an Oasis
keys server repository)</p>
<p>It is also possible to run the script by defining these arguments in a
JSON configuration file and calling the script with option <code class="docutils literal"><span class="pre">-f</span></code> and
the (relative or absolute) path to the file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">generate_keys</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">script</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">json</span><span class="o">/</span><span class="n">file</span>
</pre></div>
</div>
<p>The JSON file should contain the following keys (in no particular order)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;keys_data_path&quot;</span>
<span class="s2">&quot;model_version_file_path&quot;</span>
<span class="s2">&quot;lookup_package_path&quot;</span>
<span class="s2">&quot;model_exposures_file_path&quot;</span>
<span class="s2">&quot;output_file_path&quot;</span>
<span class="s2">&quot;output_format&quot;</span>
</pre></div>
</div>
<p>and the values of the path-related keys should be string paths, given
relative to the location of JSON file. The JSON file is usually placed
in the model keys server repository. The <code class="docutils literal"><span class="pre">&quot;output_format&quot;</span></code> key is
optional - by default the script will generate an Oasis keys file.</p>
<p>Keys records returned by an Oasis keys lookup service (see the PiWind
lookup service for reference) will be Python dicts with the following
structure</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">loc</span><span class="o">.</span> <span class="n">ID</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s2">&quot;peril_id&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">Oasis</span> <span class="n">peril</span> <span class="nb">type</span> <span class="n">ID</span> <span class="o">-</span> <span class="n">oasis_utils</span><span class="o">/</span><span class="n">oasis_utils</span><span class="o">.</span><span class="n">py</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s2">&quot;coverage&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">Oasis</span> <span class="n">coverage</span> <span class="nb">type</span> <span class="n">ID</span> <span class="o">-</span> <span class="n">see</span> <span class="n">oasis_utils</span><span class="o">/</span><span class="n">oasis_utils</span><span class="o">.</span><span class="n">py</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s2">&quot;area_peril_id&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">area</span> <span class="n">peril</span> <span class="n">ID</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s2">&quot;vulnerability_id&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">vulnerability</span> <span class="n">ID</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">lookup</span> <span class="n">status</span> <span class="n">message</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">lookup</span> <span class="n">status</span> <span class="n">code</span> <span class="o">-</span> <span class="n">see</span> <span class="n">oasis_utils</span><span class="o">/</span><span class="n">oasis_utils</span><span class="o">.</span><span class="n">py</span><span class="o">&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">generate_keys.py</span></code> script can generate keys records in this
format, and write them to file.</p>
<p>For model loss calculations however ktools requires a keys CSV file with
the following format</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">LocID</span><span class="p">,</span><span class="n">PerilID</span><span class="p">,</span><span class="n">CoverageID</span><span class="p">,</span><span class="n">AreaPerilID</span><span class="p">,</span><span class="n">VulnerabilityID</span>
<span class="o">..</span>
<span class="o">..</span>
</pre></div>
</div>
<p>where the headers correspond to the relevant Oasis keys record fields. The <code class="docutils literal"><span class="pre">generate_keys.py</span></code> script can also generate and
write Oasis keys files.</p>
</div>
<div class="section" id="generating-oasis-files">
<h2>Generating Oasis files<a class="headerlink" href="#generating-oasis-files" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">generate_oasis_files.py</span></code> is an executable script which can generate
Oasis files (items, coverages, GUL summary) for a model, given the
following arguments (in no particular order)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">generate_oasis_files</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">k</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">keys</span><span class="o">/</span><span class="n">data</span>
                          <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">version</span><span class="o">/</span><span class="n">csv</span><span class="o">/</span><span class="n">file</span>
                          <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">lookup</span><span class="o">/</span><span class="n">service</span><span class="o">/</span><span class="n">package</span>
                          <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">canonical</span><span class="o">/</span><span class="n">exposures</span><span class="o">/</span><span class="n">profile</span><span class="o">/</span><span class="n">JSON</span><span class="o">/</span><span class="n">file</span>
                          <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">exposures</span><span class="o">/</span><span class="n">file</span>
                          <span class="o">-</span><span class="n">a</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">exposures</span><span class="o">/</span><span class="n">validation</span><span class="o">/</span><span class="n">file</span>
                          <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">canonical</span><span class="o">/</span><span class="n">exposures</span><span class="o">/</span><span class="n">transformation</span><span class="o">/</span><span class="n">file</span>
                          <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">canonical</span><span class="o">/</span><span class="n">exposures</span><span class="o">/</span><span class="n">validation</span><span class="o">/</span><span class="n">file</span>
                          <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">canonical</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">exposures</span><span class="o">/</span><span class="n">transformation</span><span class="o">/</span><span class="n">file</span>
                          <span class="o">-</span><span class="n">x</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">xtrans</span><span class="o">/</span><span class="n">executable</span>
                          <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">oasis</span><span class="o">/</span><span class="n">files</span><span class="o">/</span><span class="n">directory</span><span class="p">]</span>
</pre></div>
</div>
<p>When calling the script this way paths can be given relative to the
script, in particular, file paths should include the filename and
extension. The paths to the keys data, lookup service package, model
version file, canonical exposures profile JSON, source exposures file,
transformation and validation files, will usually be located in the
model keys server repository. The path to the Oasis files directory is
optional - by default the script will create a timestamped folder in
<code class="docutils literal"><span class="pre">omdk/runs</span></code> with the prefix <code class="docutils literal"><span class="pre">OasisFiles</span></code>.</p>
<p>It is also possible to run the script by defining these arguments in a
JSON configuration file and calling the script using the path to this
file using the option <code class="docutils literal"><span class="pre">-f</span></code> and the (relative or absolute) path to the
file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">generate_oasis_files</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">script</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">json</span><span class="o">/</span><span class="n">file</span>
</pre></div>
</div>
<p>The JSON file contain the following keys (in no particular order)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;keys_data_path&quot;</span>
<span class="s2">&quot;model_version_file_path&quot;</span>
<span class="s2">&quot;lookup_package_path&quot;</span>
<span class="s2">&quot;canonical_exposures_profile_json_path&quot;</span>
<span class="s2">&quot;source_exposures_file_path&quot;</span>
<span class="s2">&quot;source_exposures_validation_file_path&quot;</span>
<span class="s2">&quot;source_to_canonical_exposures_transformation_file_path&quot;</span>
<span class="s2">&quot;canonical_exposures_validation_file_path&quot;</span>
<span class="s2">&quot;canonical_to_model_exposures_transformation_file_path&quot;</span>
<span class="s2">&quot;xtrans_path&quot;</span>
<span class="s2">&quot;oasis_files_path&quot;</span>
</pre></div>
</div>
<p>and the values of these keys should be string paths, given relative to
the location of the JSON file. The JSON file is usually placed in the
model keys server repository. The <code class="docutils literal"><span class="pre">&quot;oasis_files_path&quot;</span></code> key is optional
- by default the script will create a timestamped folder in
<code class="docutils literal"><span class="pre">omdk/runs</span></code> with the prefix <code class="docutils literal"><span class="pre">OasisFiles</span></code>.</p>
</div>
<div class="section" id="generating-losses">
<h2>Generating losses<a class="headerlink" href="#generating-losses" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">generate_losses.py</span></code> is an executable script which, given Oasis files,
model analysis settings JSON file, model data, and some other
parameters, can generate losses using the installed ktools framework.
The script can be called directly from the command line given the
following arguments (in no particular order)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">generate_losses</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">oasis</span><span class="o">/</span><span class="n">files</span>
                     <span class="o">-</span><span class="n">j</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">analysis</span><span class="o">/</span><span class="n">settings</span><span class="o">/</span><span class="n">json</span><span class="o">/</span><span class="n">file</span>
                     <span class="o">-</span><span class="n">m</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">data</span>
                     <span class="p">[</span><span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">directory</span><span class="p">]</span>
                     <span class="p">[</span><span class="o">-</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">ktools</span> <span class="n">script</span> <span class="n">name</span> <span class="p">(</span><span class="n">without</span> <span class="n">file</span> <span class="n">extension</span><span class="p">)</span><span class="o">&gt;</span><span class="p">]</span>
                     <span class="p">[</span><span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">number</span> <span class="n">of</span> <span class="n">ktools</span> <span class="n">calculation</span> <span class="n">processes</span> <span class="n">to</span> <span class="n">use</span><span class="o">&gt;</span><span class="p">]</span>
                     <span class="p">[</span><span class="o">--</span><span class="n">execute</span> <span class="o">|</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">execute</span><span class="p">]</span>
</pre></div>
</div>
<p>When calling the script this way paths can be given relative to the
script, in particular, file paths should include the filename and
extension. The path to the model run directory is optional - by default
the script will create a timestamped folder in <code class="docutils literal"><span class="pre">omdk/runs</span></code> with the
prefix <code class="docutils literal"><span class="pre">ProgOasis</span></code>. The ktools script name and number of calculation
processes are optional - by default the script will create a ktools
script named <code class="docutils literal"><span class="pre">run_tools.sh</span></code> and set the number of calculation
processes to 2. By default executing <code class="docutils literal"><span class="pre">generate_losses.py</span></code> will
automatically execute the ktools losses script it generates. If you
don’t want this provide the (optional) <code class="docutils literal"><span class="pre">--no-execute</span></code> argument. The
default here is automatic execution.</p>
<p>The script copies the analysis settings JSON file to the model run
directory and sets up the following folder structure inside</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>├── analysis_settings.json
├── fifo/
├── input/
├── output/
├── static/
└── work/
</pre></div>
</div>
<p>Depending on the OS type the model data is symlinked (Linux, Darwin) or
copied (Cygwin, Windows) into the <code class="docutils literal"><span class="pre">static</span></code> subfolder. The input files
are kept in the <code class="docutils literal"><span class="pre">input</span></code> subfolder and the losses are generated as CSV
files in the <code class="docutils literal"><span class="pre">output</span></code> subfolder.</p>
<p>It is also possible to run the script by defining these arguments in a
JSON configuration file and calling the script using the path to this
file using the option <code class="docutils literal"><span class="pre">-f</span></code> and the (relative or absolute) path to the
file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">generate_losses</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">script</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">json</span><span class="o">/</span><span class="n">file</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>The JSON file should contain the following keys (in no particular order)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;oasis_files_path&quot;</span>
<span class="s2">&quot;analysis_settings_json_file_path&quot;</span>
<span class="s2">&quot;model_data_path&quot;</span>
<span class="s2">&quot;model_run_dir_path&quot;</span>
<span class="s2">&quot;ktools_script_name&quot;</span>
<span class="s2">&quot;ktools_num_processes&quot;</span>
<span class="s2">&quot;execute&quot;</span>
</pre></div>
</div>
<p>and the values of the path-related keys should be string paths, given
relative to the location of the JSON file. The JSON file is usually
placed in the model keys server repository. The <code class="docutils literal"><span class="pre">&quot;model_run_dir_path&quot;</span></code>
key is optional - by default the script will create a timestamped folder
in <code class="docutils literal"><span class="pre">omdk/runs</span></code> with the prefix <code class="docutils literal"><span class="pre">ProgOasis</span></code>. The
<code class="docutils literal"><span class="pre">&quot;ktools_script_name&quot;</span></code> and <code class="docutils literal"><span class="pre">&quot;ktools_num_processes&quot;</span></code> keys are
optional - by default the script will create a ktools script named
<code class="docutils literal"><span class="pre">run_tools.sh</span></code> and set the number of calculation processes to 2. The
<code class="docutils literal"><span class="pre">&quot;execute&quot;</span></code> key is optional - if present it should be either <code class="docutils literal"><span class="pre">true</span></code>
or <code class="docutils literal"><span class="pre">false</span></code> depending on whether you want the generated ktools losses
scripts to be automatically executed or not. The default here is
automatic execution.</p>
</div>
<div class="section" id="running-a-model-end-to-end">
<h2>Running a model end-to-end<a class="headerlink" href="#running-a-model-end-to-end" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">run_model.py</span></code> is an executable “master” script that can run models
end-to-end, i.e. generate losses given model resources, including keys
data, canonical exposure profiles, exposure transformation and
validation files, model data, analysis settings etc., given the
following arguments (in no particular order)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run_model</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">k</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">keys</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">folder</span>
               <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">version</span><span class="o">/</span><span class="n">file</span>
               <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">keys</span><span class="o">/</span><span class="n">lookup</span><span class="o">/</span><span class="n">service</span><span class="o">/</span><span class="n">package</span>
               <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">canonical</span><span class="o">/</span><span class="n">exposures</span><span class="o">/</span><span class="n">profile</span><span class="o">/</span><span class="n">JSON</span><span class="o">/</span><span class="n">file</span>
               <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">exposures</span><span class="o">/</span><span class="n">file</span>
               <span class="o">-</span><span class="n">a</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">exposures</span><span class="o">/</span><span class="n">validation</span><span class="o">/</span><span class="n">file</span>
               <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">canonical</span><span class="o">/</span><span class="n">exposures</span><span class="o">/</span><span class="n">transformation</span><span class="o">/</span><span class="n">file</span>
               <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">canonical</span><span class="o">/</span><span class="n">exposures</span><span class="o">/</span><span class="n">validation</span><span class="o">/</span><span class="n">file</span>
               <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">canonical</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">exposures</span><span class="o">/</span><span class="n">transformation</span><span class="o">/</span><span class="n">file</span>
               <span class="o">-</span><span class="n">x</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">xtrans</span><span class="o">/</span><span class="n">executable</span>
               <span class="o">-</span><span class="n">j</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">analysis</span><span class="o">/</span><span class="n">settings</span><span class="o">/</span><span class="n">json</span><span class="o">/</span><span class="n">file</span>
               <span class="o">-</span><span class="n">m</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">data</span>
               <span class="p">[</span><span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">directory</span><span class="p">]</span>
               <span class="p">[</span><span class="o">-</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">ktools</span> <span class="n">script</span> <span class="n">name</span> <span class="p">(</span><span class="n">without</span> <span class="n">file</span> <span class="n">extension</span><span class="p">)</span><span class="o">&gt;</span><span class="p">]</span>
               <span class="p">[</span><span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">number</span> <span class="n">of</span> <span class="n">ktools</span> <span class="n">calculation</span> <span class="n">processes</span> <span class="n">to</span> <span class="n">use</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p>When calling the script this way paths can be given relative to the
script, in particular, file paths should include the filename and
extension. The paths to the keys data, lookup service package, model
version file, canonical exposures profile JSON, source exposures file,
transformation and validation files, and analysis settings JSON file,
will usually be located in the model keys server repository. The path to
the model run directory is optional - by default the script will create
a timestamped folder in <code class="docutils literal"><span class="pre">omdk/runs</span></code> with the prefix <code class="docutils literal"><span class="pre">ProgOasis</span></code>. The
ktools script name and number of calculation processes are also optional
- by default the script will create a ktools script named
<code class="docutils literal"><span class="pre">run_tools.sh</span></code> and set the number of calculation processes to 2.</p>
<p>It is also possible to run the script by defining these arguments in a
JSON configuration file and calling the script using the path to this
file using the option <code class="docutils literal"><span class="pre">-f</span></code> and the (relative or absolute) path to the
file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run_model</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">script</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">json</span><span class="o">/</span><span class="n">file</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>The JSON file should contain the following keys (in no particular order)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;keys_data_path&quot;</span>
<span class="s2">&quot;model_version_file_path&quot;</span>
<span class="s2">&quot;lookup_package_path&quot;</span>
<span class="s2">&quot;canonical_exposures_profile_json_path&quot;</span>
<span class="s2">&quot;source_exposures_file_path&quot;</span>
<span class="s2">&quot;source_exposures_validation_file_path&quot;</span>
<span class="s2">&quot;source_to_canonical_exposures_transformation_file_path&quot;</span>
<span class="s2">&quot;canonical_exposures_validation_file_path&quot;</span>
<span class="s2">&quot;canonical_to_model_exposures_transformation_file_path&quot;</span>
<span class="s2">&quot;xtrans_path&quot;</span>
<span class="s2">&quot;analysis_settings_json_file_path&quot;</span>
<span class="s2">&quot;model_data_path&quot;</span>
<span class="s2">&quot;model_run_dir_path&quot;</span>
<span class="s2">&quot;ktools_script_name&quot;</span>
<span class="s2">&quot;ktools_num_processes&quot;</span>
</pre></div>
</div>
<p>and the values of the path-related keys should be string paths, given
relative to the location of the JSON file. The JSON file is usually placed in the model keys server
repository. The <code class="docutils literal"><span class="pre">&quot;model_run_dir_path&quot;</span></code> key is optional - by default
the script will create a timestamped folder in <code class="docutils literal"><span class="pre">omdk/runs</span></code> with the
prefix <code class="docutils literal"><span class="pre">ProgOasis</span></code>. The <code class="docutils literal"><span class="pre">&quot;ktools_script_name&quot;</span></code> and
<code class="docutils literal"><span class="pre">&quot;ktools_num_processes&quot;</span></code> keys are optional - by default the script
will create a ktools script named <code class="docutils literal"><span class="pre">run_tools.sh</span></code> and set the number of
calculation processes to 2.</p>
<p>You can define a separate JSON configuration file for each model,
provided you have the model keys server repository and other required
model resources available locally.</p>
<p><strong>NOTE</strong>: For a given model the JSON script configuration files for
<code class="docutils literal"><span class="pre">generate_oasis_files.py</span></code>, <code class="docutils literal"><span class="pre">generate_losses.py</span></code> and <code class="docutils literal"><span class="pre">run_model.py</span></code>
should complement each other, except for <code class="docutils literal"><span class="pre">generate_losses.py</span></code> which
requires the path to Oasis files, not required by <code class="docutils literal"><span class="pre">run_model.py</span></code>. You
can run any of these scripts against a single master script
configuration file, provided that the path to an actual set of Oasis
files is added in order to run <code class="docutils literal"><span class="pre">generate_losses.py</span></code>.</p>
</div>
<div class="section" id="running-piwind">
<h2>Running PiWind<a class="headerlink" href="#running-piwind" title="Permalink to this headline">¶</a></h2>
<p>PiWind is a reference windstorm model developed by Oasis. The lookup
source code, keys server, keys data and model data and all other model
resources are in the model GitHub repository which is</p>
<p><a class="reference external" href="https://github.com/OasisLMF/OasisPiWind">https://github.com/OasisLMF/OasisPiWind</a></p>
<p>The repository also contains a <a class="reference external" href="ttps://github.com/OasisLMF/OasisPiWind/blob/master/mdk-oasislmf-piwind.json">JSON configuration file</a> for the model
which can be used to run it end-to-end with the MDK master script.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;keys_data_path&quot;</span><span class="p">:</span> <span class="s2">&quot;keys_data/PiWind&quot;</span><span class="p">,</span>
    <span class="s2">&quot;model_version_file_path&quot;</span><span class="p">:</span> <span class="s2">&quot;keys_data/PiWind/ModelVersion.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lookup_package_path&quot;</span><span class="p">:</span> <span class="s2">&quot;src/keys_server&quot;</span><span class="p">,</span>
    <span class="s2">&quot;canonical_exposures_profile_json_path&quot;</span><span class="p">:</span> <span class="s2">&quot;oasislmf-piwind-canonical-profile.json&quot;</span><span class="p">,</span>
    <span class="s2">&quot;source_exposures_file_path&quot;</span><span class="p">:</span> <span class="s2">&quot;tests/data/SourceLocPiWind.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;source_exposures_validation_file_path&quot;</span><span class="p">:</span> <span class="s2">&quot;flamingo/PiWind/Files/ValidationFiles/Generic_Windstorm_SourceLoc.xsd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;source_to_canonical_exposures_transformation_file_path&quot;</span><span class="p">:</span> <span class="s2">&quot;flamingo/PiWind/Files/TransformationFiles/MappingMapToGeneric_Windstorm_CanLoc_A.xslt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;canonical_exposures_validation_file_path&quot;</span><span class="p">:</span> <span class="s2">&quot;flamingo/PiWind/Files/ValidationFiles/Generic_Windstorm_CanLoc_B.xsd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;canonical_to_model_exposures_transformation_file_path&quot;</span><span class="p">:</span> <span class="s2">&quot;flamingo/PiWind/Files/TransformationFiles/MappingMapTopiwind_modelloc.xslt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;xtrans_path&quot;</span><span class="p">:</span> <span class="s2">&quot;../omdk/xtrans/xtrans.exe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;analysis_settings_json_file_path&quot;</span><span class="p">:</span> <span class="s2">&quot;analysis_settings.json&quot;</span><span class="p">,</span>
    <span class="s2">&quot;model_data_path&quot;</span><span class="p">:</span> <span class="s2">&quot;model_data/PiWind&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>NOTE</strong>: All the paths, except for the <code class="docutils literal"><span class="pre">xtrans.exe</span></code> executable, are
given relative to the location of the PiWind repository. The
<code class="docutils literal"><span class="pre">xtrans.exe</span></code> executable is not part of the MDK repository, and you
need to build it for your platform by running the <code class="docutils literal"><span class="pre">make-trans</span></code>
executable shell script - this will built it in the <code class="docutils literal"><span class="pre">omdk/xtrans</span></code>
folder. For the <code class="docutils literal"><span class="pre">xtrans.exe</span></code> path to be found you should locate the
MDK repository adjacent to the PiWind repository, i.e.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">|-</span> <span class="n">OasisPiWind</span><span class="o">/</span>
<span class="o">|-</span> <span class="n">omdk</span><span class="o">/</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">omdk</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="repository-management.html">Repository Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="sphinx.html">Sphinx Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Building and running models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#generating-keys">Generating keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generating-oasis-files">Generating Oasis files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generating-losses">Generating losses</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-a-model-end-to-end">Running a model end-to-end</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-piwind">Running PiWind</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Module Documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="requirements.html" title="previous chapter">Requirements</a></li>
      <li>Next: <a href="modules.html" title="next chapter">Module Documentation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017-2020, Oasis Loss Modelling Framework (v. 1.1, 20 January, 2018).
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/building-and-running-models.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>